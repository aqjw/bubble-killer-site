import{y as B,z as C,r as _,a as y,o as d,c as k,h as m,d as v,b as u,k as h,u as a,w as $,f as T,x as L,s as b,A as w,B as I,C as M,Z as A,F as S,l as N,g as V,e as F}from"./app-CnZfFfwp.js";import{_ as z}from"./CardTask--7xkd5LC.js";import{_ as E}from"./AppLayout-CLEw8QmJ.js";import"./Navbar-SUQw11o8.js";const R=()=>({page:1,total:0,items:[],has_more:!0}),j={},H={$resetItems(){this.items=[],this.has_more=!0},$resetAll(){this.$resetItems(),this.page=1},$loadTasks(r){axios.get(route("upi.tasks"),{params:{page:this.page}}).then(({data:e})=>{this.page===1&&this.$resetItems(),this.page++,this.items.push(...e.items),this.total=e.total,this.has_more=e.has_more,r.success()}).catch(({response:e})=>{r.error(e)}).finally(()=>{r.finish()})}},U=B("taskStore",{state:R,getters:j,actions:H}),Z={class:"flex items-center justify-center"},q={__name:"InfiniteScroll",props:{items:Array,onLoad:Function,hasMore:Boolean},setup(r,{expose:e}){const n=r,{items:p,onLoad:x,hasMore:i}=C(n),t=_(!1),l=()=>{t.value=!0,n.onLoad(()=>{t.value=!1})};return e({load:l,reload:()=>{l()}}),(c,o)=>{const f=y("v-progress-circular"),g=y("v-btn");return d(),k("div",null,[m(c.$slots,"default"),v("div",Z,[t.value?m(c.$slots,"loading",{key:0},()=>[u(f,{indeterminate:"",size:30,width:2,color:"primary"})]):h("",!0),!t.value&&a(i)?m(c.$slots,"load-more",{key:1},()=>[u(g,{variant:"tonal",class:"text-none",color:"primary",density:"comfortable",onClick:l},{default:$(()=>o[0]||(o[0]=[T(" Load More ")])),_:1})]):h("",!0),!a(i)&&!a(p).length?m(c.$slots,"empty",{key:2},()=>[o[1]||(o[1]=v("div",null,"Ничего не найдено",-1))]):h("",!0)])])}}},D={class:"space-y-4 mb-4"},P={__name:"Index",props:{},setup(r){L.useToast();const e=U(),{items:n,has_more:p,total:x}=b(e),i=_(null),t=_(!1);w(()=>{I(()=>{var s;(s=i.value)==null||s.load()})});const l=s=>{t.value=!0,e.$loadTasks({success:()=>{},error:()=>{},finish:()=>{t.value=!1,s()}})};return M(()=>{e.$resetAll()}),(s,c)=>(d(),k(S,null,[u(a(A),{title:"History"}),u(E,null,{default:$(()=>[u(q,{ref_key:"infiniteScroll",ref:i,items:a(n),"has-more":a(p),"on-load":l},{default:$(()=>[v("div",D,[(d(!0),k(S,null,N(a(n),(o,f)=>(d(),V(z,{key:f,task:o,onClick:F(g=>s.$inertia.visit(s.route("tasks.show",o.id)),["stop","prevent"])},null,8,["task","onClick"]))),128))])]),_:1},8,["items","has-more"])]),_:1})],64))}};export{P as default};
